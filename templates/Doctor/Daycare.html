{% extends "base.html" %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
{% block content %}
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DayCare Screen</title>
    <link rel="shortcut icon" href="{% static 'assets/img/mahi.png' %}">
    

    <!-- !-- Bootstrap CSS --> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,500;0,600;0,700;1,400&amp;display=swap"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
     
    
    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/css/bootstrap-select.min.css">

    <style>
      .navbar-orange {
        background-color:#008373;
        box-shadow: 0px 4px 8px;
      }
      .navbar-brand1 {
            color: #FFFFFF;
            font-size: 25px;
        }
      .label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* margin: 0; */
    }

    .label-row label {
      font-size: 20px; /* Adjust font size as needed */
    }
    .input-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      align-items: center;
    }

    .input-row label {
      flex: 1;
      text-align: center;
      padding-right: 0px;
      font-size: 20px;
    }

    .input-row input {
      flex: 2;
      width: 100%;
      margin: 5px;
      padding: 5px;
      box-sizing: border-box;
    }

    .row {
      display: flex;
      align-items: right;
    }

    .row label {
      flex: 1; /* This will make the label take up 1/3 of the row width */
      margin-right: 10px; /* Adjust margin as needed */
    }

    .row input {
      flex: 1; /* This will make the input field take up 2/3 of the row width */
      /* Add any additional styling here */
      margin-right: 10px;
    }
    /* styles.css */
      #navbar, #title {
        display: block;
      }

      /* Hide navbar and title when printing */
      @media print {
        .navbar, #title {
          display: none;
        }
      }

        /* Custom CSS for select2 */
      
      .data-block2 {
          border: 1px solid #ddd;
          padding: 7px;
          margin-bottom: 5px;
          cursor: pointer;
          background-color: #109787;
          border-radius: 10px;
          transition: background-color 0.3s;
      }

      /* Tab styles */
      .tab-container {
        display: flex;
        flex-direction: column;
        padding: 0;
        margin: 0;
      }

      .tab-menu {
        display: flex;
        justify-content: space-around;
        background-color: #f1f1f1;
        padding: 10px;
      }

      .tab-menu div {
        cursor: pointer;
        padding: 5px 10px;
        background-color: #ddd;
        margin: 2px;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .tab-menu div.active {
        background-color: #008373;
        color: #fff;
      }

      .tab-content {
        display: none;
        padding: 10px;
        background-color: #f9f9f9;
        border-top: none;
        margin: 0;
      }

      .tab-content.active {
        display: block;
      }

      .container{
        margin: 0;
        padding: 0;
        margin-right: 5px;
      }
        /* Loader styles */
        #loader {
          position: fixed;
          left: 50%;
          top: 30%;
          transform: translate(-50%, -50%);
          border: 16px solid #f3f3f3;
          border-radius: 50%;
          border-top: 16px solid #f5873e;
          width: 120px;
          height: 120px;
          -webkit-animation: spin 2s linear infinite;
          animation: spin 2s linear infinite;
          display: none;
          z-index: 1000;
      }

      @-webkit-keyframes spin {
          0% {
              -webkit-transform: rotate(0deg);
          }

          100% {
              -webkit-transform: rotate(360deg);
          }
      }

      @keyframes spin {
          0% {
              transform: rotate(0deg);
          }

          100% {
              transform: rotate(360deg);
          }
      }  
      
        /* Custom CSS for select2 */
        .select2-container--default .select2-selection--single {
          border: 1px solid #ced4da;
          border-radius: .25rem;
          height: calc(2.50rem + 15px);
          background-color: #fff;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: calc(1.65rem + 40px);
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: calc(2.50rem + 40px);
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow b {
            border-color: #000 transparent transparent transparent;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            top: 6px;
            right: 8px;
        }
        .select2-container--default .select2-dropdown {
            max-height: 750px; /* Adjust the maximum height as needed */
            overflow-y: auto; /* Enable vertical scrollbar if needed */
        }
    </style>
  </head>

  <body>
    <div id="overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;"></div>
    <div id="loader"></div>
    <form id="myForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="appointment_id" value="{{get_patient_by_appointment_id.appointment_id}}"/>
        <div class="container">
          <div class="data-block2 mb-1">
            <div class="container-fluid d-flex justify-content-between align-items-center">
                <a class="navbar-brand1" href="{% url 'get_all_doctor_appointments' %}" >
                    <i class="fas fa-arrow-left"></i>  Daycare
                </a>
            </div>
          </div>

          <div class="card" style="margin-bottom: 5px;padding: 1%;">
            <div class="label-row" style="margin-left: 1px;">
              <label for="label1" style="font-size: 20px;">Patient : {{ get_patient_by_appointment_id.appointment_name }}</label>
              <label for="label1" style="font-size: 20px;">
                {% if get_patient_by_appointment_id.age %}
                  Age : {{ get_patient_by_appointment_id.age }}
                {% else %}
                {% endif %}
              </label>
              <label for="label1" style="font-size: 20px;">
                {% if get_patient_by_appointment_id.appointment_gender == 0 %}
                    Gender : Male
                {% else %}
                    Gender : Female
                {% endif %}
              </label>
              <label for="label2"style="font-size: 20px; "><i class="fa-solid fa-user-group" style="color: #008373;"></i> {{get_patient_by_appointment_id.appointment_token}}</label>
            </div>
        
            <div class="label-row mb-2" style="margin-left: 1px;">
              <label for="label2">Mobile: {{get_patient_by_appointment_id.appointment_mobileno}}{{patient_info.appointment_mobileno}}</label>
              <label for="label2"> Balance: {{outstanding}} <i class="fa-solid fa-indian-rupee-sign" style="font-size: 18px;"></i></label>
              <label for="label2" style="font-size: 20px;">
                <i class="fa-solid fa-circle-user"></i>
                {% if get_patient_by_appointment_id.appointment_status == 1 %}
                    Open
                {% elif get_patient_by_appointment_id.appointment_status == 2 %}
                    In Process
                {% elif get_patient_by_appointment_id.appointment_status >= 3 %}
                    Completed
                {% endif %}
              </label>
            </div>
            <!-- <div class="d-flex justify-content-between mb-2 ">
              <label for="" class="col-5" style="font-size: 20px;">Referred By </label>
              <input type="text" class="form-control form-control-sm me-2"   name="referred_by_doctor" value="{{consult_data.referred_by_doctor}}" style="margin-left: 1%; margin-right: 0%; font-size: 16px;"  required>
            </div>
            <div class="d-flex justify-content-between">
              <label for="" class="col-5" style="font-size: 20px;">Referred To</label>
              <input type="text"  class="form-control form-control-sm me-2" name="referred_to_doctor" value="{{consult_data.referred_to_doctor}}" style="margin-left: 1%; margin-right: 0%; font-size: 16px;"   required>
            </div> -->
            <div class="row">
              <div class="col-3">
                <div class="form-floating">
                  <input type="text" class="form-control" name="referred_by_doctor" value="{%if consult_data.referred_by_doctor%}{{consult_data.referred_by_doctor}}{%endif%}" >
                    <label for="referred_by_doctor">Referred By</label>
                </div>
              </div>
              <div class="col-3">
                <div class="form-floating">
                  <input type="text"  class="form-control" name="referred_to_doctor" value="{% if consult_data.referred_to_doctor%}{{consult_data.referred_to_doctor}}{%endif%}" >
                  <label for="referred_to_doctor">Referred To</label>
                </div>
              </div> 
            </div>
            
            <hr style="margin-top:2px;margin-bottom: 2px;">
          <!-- <div class="tab-container">
            <div class="tab-menu">
             <div class="tab" onclick="toggleTab('content1')">Assessment</div>
             <div class="tab" onclick="toggleTab('content1')">Consultation</div>
             <div class="tab" onclick="toggleTab('content1')">Labs</div>
             <div class="tab" onclick="toggleTab('content1')">Medicine</div>
            </div>
          </div> -->
          <div class="tab-container">
            <div class="tab-menu">
              <div class="tab active" data-tab="tab1">Assessment</div>
              <div class="tab" data-tab="tab2">Consultation</div>
              <div class="tab" data-tab="tab3">Labs</div>
              <div class="tab" data-tab="tab4">Medicines</div>
              <!-- <div class="tab" data-tab="tab5">Diagnosis</div>
              <div class="tab" data-tab="tab6">Advice</div>
              <div class="tab" data-tab="tab7">Treatment</div>
              <div class="tab" data-tab="tab8">Lab Investigation</div>
              <div class="tab" data-tab="tab9">Follow-Up</div>
              <div class="tab" data-tab="tab10">Instructions</div>  -->
            </div>
          <div id="tab1" class="tab-content">
            <div class="col">
              <div class="d-flex justify-content-between">
               <label for="Name" class=" times-new-roman fw-bold mb-1" style="font-size:20px;">Clinical Examinations</label>
             </div> 
            </div>
            
            {% for i in get_patient_boimterics_vitals %}
           <input type ="hidden" value="{{i.doctor_id}}" name ="Doctor_Id"/>
           <input type ="hidden" value="{{i.patient_id }}" name ="Patient_Id"/>
           <input type = "hidden" value="{{i.patient_status}}" name = "Patient_Status"/>
           <!-- <input type=" hiden" value="{{i.consultation_id}}" name ="consultation_id"/> -->
           <input type ="hidden" value="{{get_patient_by_appointment_id.appointment_datetime}}" name = "Consultation_DateTime"/>
                  <div class="row">
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="inputWeight" name="weight" value="{% if i.weight %}{{i.weight}}{%endif%}" placeholder="Weight">
                            <label for="inputWeight">Weight (Kg)</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="inputHeight" name="height" value="{% if i.height %}{{i.height}}{%endif%}" placeholder="Height">
                            <label for="inputHeight">Height (cm)</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="inputBMI" name="bmi" value="{% if i.bmi %}{{ i.bmi}}{%endif%}" placeholder="BMI" readonly>
                            <label for="inputBMI">BMI (kg/m&sup2;)</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="inputTemp" name="temp" value="{% if i.patient_temparature %}{{i.patient_temparature}}{%endif%}" placeholder="Temperature">
                            <label for="inputTemp">Temperature (°F)</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="bp_s" name="bp_s" value="{% if i.patient_bpsystolic %}{{i.patient_bpsystolic}}{%endif%}" placeholder="BP Systolic">
                            <label for="bp_s">BP Systolic</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="bp_d" name="bp_d" value="{% if i.patient_bpdistolic %}{{i.patient_bpdistolic}}{%endif%}" placeholder="BP Diastolic">
                            <label for="bp_d">BP Diastolic</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="heart_rate" name="heart_rate" value="{% if i.patient_heartratepluse %}{{i.patient_heartratepluse}}{%endif%}" placeholder="Heart Rate">
                            <label for="heart_rate">Heart Rate(Per/min)</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <input type="number" class="form-control" id="respiratory_rate" name="respiratory_rate" value="{% if i.patient_respiratoryrate %}{{i.patient_respiratoryrate}}{%endif%}" placeholder="Respiratory Rate">
                            <label for="respiratory_rate">Respiratory Rate</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="form-floating">
                            <select class="form-control" id="pain_scale" name="pain_scale">
                                <option value=""selected>Select Pain Scale</option>
                                {% for value in pain_scale_range %}
                                    <option value="{{ value }}" {% if value == i.patient_painscale %} selected {% endif %}>{{ value }}</option>
                                {% endfor %}
                            </select>
                            <label for="pain_scale">Pain Scale</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                      <div class="form-floating">
                        <input type="text" id="inputField" class="form-control form-control-sm me-2" name="chest" placeholder=" " {% if i.patient_chest != '0' %} value="{{i.patient_chest}}" {%endif%}   style="margin-right:1% ;font-size: 16px;">
                        <label for="chest">Chest</label>
                      </div>
                    </div>
                    <div class="col-md-6 mb-2">
                      <div class="form-floating">
                        <textarea id="inputField" class="form-control form-control-sm me-2" name="ecg" placeholder=" "  style="margin-right: 1%; font-size: 16px;">{% if i.patient_ecg != '0' %}{{ i.patient_ecg }}{%endif%}</textarea>
                          <label for="ecg">ECG</label>
                      </div>
                    </div>        
                </div>
             
            {%endfor%}
          </div>
        </div>
        </div> 
        </div>
        <div id="tab2" class="tab-content" style="margin: 0;">
          <!------------- Complain------------ -->
         <div class="container col-5 me-5" style="display: inline-block;">
           <div class="card "  style="padding: 1%;margin: 0; margin-bottom: 5px;height: 150px;width:110%;">
               <div class="row">
                   <div class="col ">
                     <div class="d-flex justify-content-between">
                       <label for="Name" class="col-sm-8 col-form-label times-new-roman fw-bold" style="font-size:20px;">Complaint{% if not symptoms_data.symtoms  %}<span style="color: red; font-weight: bold; font-size: 1em;">*</span>{%endif%}</label>
                       
                     </div>
                   </div>
                 </div>
                 <div class="col-12">
                   <div class="form-group">
                       <textarea type="text" placeholder="Type here" class="form-control" style="height: 50px;" name="complaint_details" rows="8" required>{{symptoms_data.symtoms}}</textarea>
                   </div>
                 </div>
           </div>
         </div>
 
         <!-- Diagnosis -->
         
         <div class="container col-5 " style="display: inline-block;">
           <div class="card "  style="padding: 1%;margin-bottom: 5px; height: 150px;width: 130%;">
               <div class="row">
                   <div class="col ">
                     <div class="d-flex justify-content-between">
                       <label for="Name" class="col-sm-8 col-form-label times-new-roman fw-bold" style="font-size:20px;">Diagnosis{% if not symptoms_data.findings  %}<span style="color: red; font-weight: bold; font-size: 1em;">*</span>{%endif%}</label>
                       
                     </div>
                   </div>
                 </div>
                 <div class="col-12">
                   <div class="form-group">
                       <textarea type="text" placeholder="Type here" class="form-control" style="height: 50px;" name="Diagnosis"  rows="8" required>{{ symptoms_data.findings }}</textarea>
                   </div>
                 </div>
           </div>
         </div>
        
         <!-- KCO -->
         <div class="container col-5 me-5" style="display: inline-block;">
           <div class="card" style="margin: 0; padding: 1%; height: 150px;width:110%;">
               <div class="pt-3">
                   <div class="col-12 mb-2">
                       <!-- {{kco}} -->
                       <div class="d-flex justify-content-between mb-2">
                           <label for="" class="fw-bold times-new-roman" style="margin-right:2%;font-size: 20px;">KCO</label>
                           <select class="form-control search form-select" id="kco"   onchange="UpdateKCOTextArea()">
                               <option value="Kco" disabled selected hidden>None</option>
                               <option value="clear">Clear</option>
                              
                               {% for i in kco %}
                               <option value="{{ i.datacodevalue }}">{{ i.datacodedescription }}</option>
                               {% endfor %}
                           </select>
                       </div>
                   </div>
                   <div class="col-12">
                       <div class="form-group">
                           <textarea type="text" name="kco" style="height: 50px;" id="selectedKCOTextArea" placeholder="display selected options here" class="form-control" rows="4" >{%if symptoms_data.kco%}{{symptoms_data.kco}}{%endif%}</textarea>
                       </div>
                   </div>
               </div>
           </div>
       </div>
 
         
         
           <!-- Advice -->
         <div class="container col-6" style=" display: inline-block;">
           <div class="card" style="margin: 0; padding: 1%;margin-bottom: 5px; height: 150px;width: 108%;">
             <div class="pt-3">
               <div class="col-12 mb-2">
                 <div class="d-flex justify-content-between mb-2">
                   <label for="" class="  fw-bold times-new-roman" style="margin-right:2% ;font-size: 20px;">Advice</label>
                   <select class="form-control search form-select" name="advice" id="advice"    onchange="updateAdviceTextArea()" >
                     <option value="Adv" disabled selected hidden>Advice</option>
                     <option value="clear">Clear</option>
                     {% for a in advice %}
                     <option value="{{a.datacodevalue}}">{{a.datacodedescription}}</option>
                     {%endfor%}
                   </select>
               </div>
               </div>
               </div>
               <div class="col-12">
                   <div class="form-group">
                       <textarea type="text" name="advice" style="height: 50px;" placeholder="Display here selected options" class="form-control" id="selectedAdviceTextArea" rows="4" >{%if symptoms_data.advice%}{{symptoms_data.advice}}{%endif%}</textarea>
                   </div>
               </div>
           </div>
           </div>
 
           <!-- <div class="container" style="margin:0%">
             <div class="card "  style="margin:0; padding: 1%;height:100px;">
                   <div class="row">
                     <div class="col-4">
                       <div class="d-flex justify-content-between">
                         <label for="Instructions" class="times-new-roman fw-bold" style="font-size:20px;">Instructions</label>
                       </div>
                     </div>
                     <div class="col-8">
                       <div class="form-group">
                           <textarea type="text" placeholder="Add Prescription" style="height: 30px;" class="form-control" name="Prescription" rows="4" required>{%if prescription %}{{prescription}}{%endif%}</textarea>
                       </div>
                     </div>
                 </div>
               </div>
               
             </div> -->
             <div class="container mb-2 " style="margin-bottom:0% ">
              <div class="card "  style="padding: 1%;">
                      <div class="col-12">
                        <div class="d-flex justify-content-between">
                          <label for="Instructions" class="times-new-roman fw-bold" style="font-size:20px;">Instructions</label>
                        </div>
                      </div>
                      <div class="col-12">
                        <div class="form-group">
                            <textarea type="text" placeholder="Add Prescription" class="form-control" name="Prescription" rows="4" >{%if prescription and prescription != '0' %}{{prescription}}{%endif%}</textarea>
                        </div>
                      </div>
                  </div>
              </div>
        </div>

    <div id="tab4" class="tab-content" style="padding: 0;">
    <!-- Treatment -->
      <div class="container mb-2">
        <div class="card p-3">
            <h2 class="fw-bold mb-1">Daycare Medication</h2>
            <div class="table-responsive mb-2">
              <table class="table">
                  <thead>
                      <tr>
                          <th>Medicine</th>
                          <th>Mode</th>
                          <th>Qty</th>
                          <th>Dosages</th>
                          <th>Instructions</th>
                          <th>Price</th>
                          <th>Remove</th>
                      </tr>
                  </thead>
                  <tbody id="medicineTableBody">
                      <!-- Dynamically populated rows will go here -->
                      {% for i in medic_list %}
                      <tr>
                          <td>{{ i.medicine_name }}</td>
                          <td>
                              {% if i.medicine_form == '1' %}
                                  Tab
                              {% elif i.medicine_form == '2' %}
                                  Syp
                              {% elif i.medicine_form == '3' %}
                                  Pwd
                              {% elif i.medicine_form == '4' %}
                                  Capsule
                              {% elif i.medicine_form == '5' %}
                                  Injection
                              {% elif i.medicine_form == '6' %}
                                  Suspension
                              {% elif i.medicine_form == '7' %}
                                  Drop
                              {% elif i.medicine_form == '8' %}
                                  other
                              {% else %}
                                  Unknown Mode
                              {% endif %}
                          </td>
                          <td>{{ i.medicine_qty }}</td>
                          <td>{{ i.medicine_doses }}</td>
                          <!-- <td>{{ i.medicine_instruction_id }}</td> -->
                          <td data-instruction-id="{{ i.medicine_instruction_id }}">{{ i.instruction_text }}</td>
                          <td>{{ i.medicine_price }}</td>
                          <td><button class="btn btn-danger btn-sm removeBtn">Remove</button></td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
          </div>

            <!-- Form for adding medicine details -->
            <div class="mb-3">
                <!-- <label for="medicineSelect" class="form-label">Medicine</label> -->
                <select class="form-select" id="medicineSelect" size="1">
                    <option value="" disabled selected hidden>Select Medicine</option>
                    <!-- Populate options dynamically -->
                    {% for m in all_medicines %}
                    <option value="{{ m.medicine_name }}" 
                            data-form="{{ m.medicine_form }}"
                            data-duration="{{ m.medicine_duration }}"
                            data-dosages="{{ m.medicine_dosages }}">
                        {{ m.medicine_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="row mb-3">
                <!-- First Row -->
                <div class="col-3">
                    <!-- <label for="modeField" class="form-label">Mode</label> -->
                    <input type="text" class="form-control" id="modeField" readonly>
                </div>
                <div class="col-2">
                    <label for="qtyField"  class="form-label mt-1">Qty:</label>
                </div>
                <div class="col-3">
                    <input type="number" class="form-control" id="qtyField" >
                </div>
                <div class="col-4">
                    <input type="text" class="form-control" id="dosagesField" readonly>
                </div>
            </div>

            <div class="row mb-3">
                <!-- Second Row -->
                <div class="col-5">
                  <!-- <select class="form-select" id="priceField">
                    <option value="EN">English</option>
                    <option value="MA">Marathi</option>
                    <option value="HI">Hindi</option>
                  </select> -->
                  <!-- <label for="priceField"  class="form-label mt-1">price:</label> -->
                  <input type="text" class="form-control" id="priceField" placeholder="Price" >
                </div>
                <div class="col-7">
                  <select class="form-select" id="instructionsSelect">
                    <option value="" disabled selected hidden>Select Instructions</option>
                    {% for inst in medicine_instruction %}
                    <option value="{{ inst.doctor_instruction_id }}">{{ inst.instruction_text }}</option>
                    {% endfor %}
                  </select>
                </div>
            </div>

            <button id="addMedicineBtn" class="btn btn-primary">Add Medicine</button>


            <!-- Hidden fields for storing form data -->
            <input type="hidden" id="Medicine_input" name="Medicine">
            <input type="hidden" id="Mode_input" name="Mode">
            <input type="hidden" id="Days_input" name="days">
            <input type="hidden" id="Dosage_input" name="dosage">
            <input type="hidden" id="Language_input" name="Language">
            <input type="hidden" id="Instructions_input" name="Instructions">
        </div>
      </div>
    </div>

    <div id="tab3" class="tab-content">
      <!-- Lab Investigation -->
      <div class="container mb-2" style="margin-bottom:0%;">
        <div class="card" style="padding: 1%;">
          <div class="col-12 mb-2">
            <div class="d-flex justify-content-between">
              <label for="Lab Investigation" class="times-new-roman fw-bold" style="font-size:20px;">Lab Investigation</label>
            </div>
            <div class="col-12 mb-2" >
              <div class="form-group">
                <textarea id="selectedOptions" type="text" placeholder="Display here selected options" class="form-control" name="lab_tests" rows="4" >{% for i in lab_list %}{{i}}{% if not forloop.last %}&#10;{% endif %}{% endfor %}</textarea>
              </div>
            </div> 
            <div class="form-group">
               <!-- Search input for the dropdown -->
               <!-- {{lab_investigation_report}}  -->
              <select class="form-control search form-select" name="labOptions"   onchange="updateTextArea()" id="labDropdown" size="1">
                <option value="" disabled selected hidden>Select Lab</option>
                <option value="clear">Clear Selection</option>
            
                {% for lab in lab_investigation_report  %}
                <option value="{{lab.investigation_name}}">{{lab.investigation_name}}</option>
                {%endfor%}
                 
              </select>
            </div>
          </div>
          
        </div>
      </div>
      {% if laboratorydata %}
        <div id="laboratorydropdown" class="container mt-3" {%if lab_list %}style="display:block" {%else%}style="display:none" {%endif%}>
            <div class="card" style="padding: 1%;">
                <div class="form-group">
                    <label for="options" class="times-new-roman fw-bold" style="font-size:20px;">Select Laboratory</label>
                    <select id="laboratoryoptions" name="laboratoryoptions[]" class="selectpicker form-control" multiple data-live-search="true">
                        {% for laboratory in laboratorydata %}
                        <option value="{{laboratory.laboratory_id}}" selected>{{laboratory.laboratory_details.laboratory_name}}</option>
                        {%endfor%}
                    </select>
                </div>
            </div>
        </div>
    {%endif%}
    </div>
  
      <!-- <div class="container mb-2 " style="margin-bottom:0% ">
      <div class="card "  style="padding: 1%;">
              <div class="col-12">
                <div class="d-flex justify-content-between">
                  <label for="Instructions" class="times-new-roman fw-bold" style="font-size:20px;">Instructions</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-group">
                    <textarea type="text" placeholder="Add Prescription" class="form-control" name="Prescription" rows="4" required>{%if prescription %}{{prescription}}{%endif%}</textarea>
                </div>
              </div>
          </div>
        
        </div> -->

      <div class="container mb-2" style="margin-bottom:0%;">
      <div class="card" style="padding: 1%;">
      <!-- <div class="pt-3"> -->
          <div class="col mb-2">
            <div class="d-flex justify-content-between mb-2">
              <label for="" class="  fw-bold times-new-roman"  style="max-width:60%; font-size: 20px;">DayCare Fee <i class="fa fa-inr"></i></label>
              <input type="number" class="form-control" name="Fess" value="{% if consult_data.consultation_fees %}{{ consult_data.consultation_fees }}{% else %}{{ default_fees }}{% endif %}" placeholder="Amount" style="max-width:40%;" />
              <input type="hidden" name="old_daycarefees" value="{{consult_data.consultation_fees}}">
              <input type="hidden" value="{{outstanding}}" name="patient_outstanding">
          </div>
          </div>
          
      </div>
      </div>
      {%if consult_data.consultation_status == 1 %}
        <div class="container mb-2" style="margin-bottom:0%;">
          <div class="card" style="padding: 1%;">
          <!-- <div class="pt-3"> -->
              <div class="col mb-2">
                <div class="d-flex justify-content-between mb-2">
                  <label for="" class="  fw-bold times-new-roman"  style="max-width:60%; font-size: 20px;">Advance Payment <i class="fa fa-inr"></i></label>
                  <input type="number" class="form-control" id="advfee" name="advfee" value="0" placeholder="Advance Pay" style="max-width:40%;" />
              </div>
              </div>
              
          </div>
        </div>
      {%endif%}
    

    <!-- {% if laboratorydata %}
        <div id="laboratorydropdown" class="container mt-3" {%if lab_list %}style="display:block" {%else%}style="display:none" {%endif%}>
            <div class="card" style="padding: 1%;">
                <div class="form-group">
                    <label for="options" class="times-new-roman fw-bold" style="font-size:20px;">Select Laboratory</label>
                    <select id="laboratoryoptions" name="laboratoryoptions[]" class="selectpicker form-control" multiple data-live-search="true">
                        {% for laboratory in laboratorydata %}
                        <option value="{{laboratory.laboratory_id}}" selected>{{laboratory.laboratory_details.laboratory_name}}</option>
                        {%endfor%}
                    </select>
                </div>
            </div>
        </div>
    {%endif%} -->
    
      <div class="container mb-5 ">
      <!-- <h1>Print and Save Example</h1> -->
      <div class="row mt-3 " style="margin-bottom:1%">
      <div class="d-flex justify-content-between">
    {% if consult_data.consultation_status != 3%}
        <button type="submit" class="btn btn-primary mx-3" id="SaveButton"  onclick="saveData()" style="background-color: #008373; border-color:#008373; color:white ;display: block;">
          <i class="fas fa-save"></i> 
            {% if consult_data %}
              Update
            {%else%}
              Save 
            {%endif%}        
        </button>
     
        <button id="backToAppointmentBtn"  class="btn btn-primary" style="display: none;background-color: #008373;"><i class="fa-solid fa-circle-arrow-left"></i> Appointment</button>
        <!-- <button class="btn btn-success" onclick="printPage()">Print & save</button>
        <button class="btn btn-primary" onclick="savePage()">Print</button> -->
        {%if consult_data%}
        <!-- <button class="btn btn-success" onclick="savePage()">Complete</button> -->
        {%if consult_data.consultation_status == 1 %} <button id="completeBtn" class="btn btn-success">Finalize</button>{%endif%}
        <button id="daycarebill" class="btn btn-info" style="color:white">Daycarebill</button>
        <div id="pdfViewer"></div>
        {%endif%}
    {%endif%}
      </div>
      </div>
      <div class="row mb-5">
      <div class="d-flex justify-content-end mb-5" >
        <!-- <button class="btn btn-danger" onclick="savePage()">Close</button> -->
      </div>
     </div>
      </div>
  
      
      </div>
      </div>
    </form>
    {%if request.session.subscription_status == 'inactive' and consult_data.consultation_status != 3 %}
        {% include "Doctor/popup.html" %}
    {%endif%}
     
     
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
  $(document).ready(function() {
    // Initialize Select2
    $('.js-select2').select2();

    // Tab functionality
    $('.tab-menu div').click(function() {
      var tabId = $(this).data('tab');
      $('.tab-menu div').removeClass('active');
      $(this).addClass('active');
      $('.tab-content').removeClass('active');
      $('#' + tabId).addClass('active');
    });
  });
</script>
<script>
    // Handle form submission
    $('#myForm').on('submit', function(e) {
        $('.btn').prop('disabled', true); // Disable the save button
        $('#loader').show(); // Show the loader
        $('#overlay').show(); // Show the overlay to disable the page
    });
</script> 
    
<script>
  function UpdateKCOTextArea() {
      var SelectElement = document.getElementById('kco');
      var TextArea = document.getElementById('selectedKCOTextArea');
      var SelectedOption = SelectElement.value;

      if (SelectedOption === "clear") {
          TextArea.value = ""; // Clear the text area
      } else {
          var ExistingOptions = TextArea.value.split('\n');
          if (!ExistingOptions.includes(SelectedOption)) {
              TextArea.value += (TextArea.value ? '\n' : '') + SelectedOption;
          }
      }
  }
</script>
<script>
  function updateAdviceTextArea() {
      var ADVICEELEMENT = document.getElementById('advice');
      var TEXTAREA = document.getElementById('selectedAdviceTextArea');
      var SELECTDOPTION = ADVICEELEMENT.value;

      if (SELECTDOPTION === "clear") {
          TEXTAREA.value = ""; // Clear the text area
      } else {
          var EXISTINGOPTION = TEXTAREA.value.split('\n');
          if (!EXISTINGOPTION.includes(SELECTDOPTION)) {
              TEXTAREA.value += (TEXTAREA.value ? '\n' : '') + SELECTDOPTION;
          }
      }
  }
</script>

<script>
  function updateTextArea() {
      var selectElement = document.querySelector('select[name="labOptions"]');
      var textArea = document.getElementById('selectedOptions');
      var selectedOption = selectElement.value;
      if (selectedOption === "clear") {
        textArea.value = ""; // Clear the text area
        document.getElementById('laboratorydropdown').style.display = 'none';
      } else {
          var existingText = textArea.value;
          if (!existingText.includes(selectedOption)) {
              if (existingText.length > 0) {
                  // Append a newline before adding the new option
                  textArea.value += '\n' + selectedOption;
              } else {
                  textArea.value += selectedOption;
              }
              document.getElementById('laboratorydropdown').style.display = 'block';
          }
      }

  }


  function saveData() {
      // Display loading circle on the button
      const saveButton = document.getElementById('saveButton');
      saveButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Saving...';

      // Simulate saving process (you would replace this with your actual saving logic)
      setTimeout(function () {
          // After saving is done, revert the button text
          saveButton.innerHTML = 'Save';
      }, 5000); // Assuming saving process takes 5 seconds
  }
</script>

<script>
  document.getElementById('daycarebill').addEventListener('click', function (event) {
      event.preventDefault();
      
      fetch('/DrishtisDesktop/daycarebillcharges/')
          .then(response => {
              if (response.ok) {
                  return response.blob();
              }
              throw new Error("Failed to generate bill");
          })
          .then(blob => {
            const url = window.URL.createObjectURL(blob);
            window.open(url, '_blank'); // Opens the PDF in a new tab
            window.URL.revokeObjectURL(url); // Cleanup URL
              // const url = window.URL.createObjectURL(blob);
              // const a = document.createElement('a');
              // a.style.display = 'none';
              // a.href = url;
              // a.download = 'daycare_bill.pdf'; 
              // document.body.appendChild(a);
              // a.click();
              // window.URL.revokeObjectURL(url);
          })
          .catch(error => {
              console.error('Error:', error);
              alert('Failed to generate bill.');
          });
  });
</script>


<script>
  document.getElementById('completeBtn').addEventListener('click', function(event) {
      event.preventDefault(); 

      // Get the value from the input box
      const advfeeValue = document.getElementById('advfee').value;

      // Disable the button and show loader
      $('.btn').prop('disabled', true); 
      $('#loader').show(); 
      $('#overlay').show(); 

      // Send AJAX request to backend
      fetch('/DrishtisDesktop/daycare_finalize/', {
          method: 'POST',  // Use POST method to send data
          headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': '{{ csrf_token }}'  // Include CSRF token for Django backend
          },
          body: JSON.stringify({
              advfee: advfeeValue  // Send advfee value
          })
      })
      .then(response => response.json())
      .then(data => {
          // Handle the response
          if (data.success) {
              alert(data.message || "Bill generated successfully!");
              window.location.reload();
          } else {
              alert(data.error || 'Failed to generate bill. Try again or contact support.');
          }
      })
      .catch(error => {
          console.error('Error:', error);
          alert('Failed to generate bill. Try again or contact support.');
      })
      // .finally(() => {
      //     $('.btn').prop('disabled', false); 
      //     $('#loader').hide(); 
      //     $('#overlay').hide(); 
      // });
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>


<!-- <script>
    // Initialize Select2
    $(document).ready(function() {
        $('#labDropdown').select2();
    });
</script> -->


<script>
    // Initialize Select2
// $(document).ready(function() {
//     $('#medicineSelect').select2();
// });

document.addEventListener('DOMContentLoaded', () => {
    const medicineSelect = document.getElementById('medicineSelect');
    const modeField = document.getElementById('modeField');
    const qtyField = document.getElementById('qtyField');
    const dosagesField = document.getElementById('dosagesField');
    const priceField = document.getElementById('priceField');
    const instructionsSelect = document.getElementById('instructionsSelect');
    const addMedicineBtn = document.getElementById('addMedicineBtn');
    const medicineTableBody = document.getElementById('medicineTableBody');
    const Medicine_input = document.getElementById('Medicine_input');
    const Mode_input = document.getElementById('Mode_input');
    const Days_input = document.getElementById('Days_input');
    const Dosage_input = document.getElementById('Dosage_input');
    const Language_input = document.getElementById('Language_input');
    const Instructions_input = document.getElementById('Instructions_input');

    // Initialize hidden fields with existing medicine list data
    updateHiddenInputValues();

    // Event listener for when a medicine is selected
    $('#medicineSelect').on('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        const form = selectedOption.getAttribute('data-form');
        const duration = selectedOption.getAttribute('data-duration');
        const dosages = selectedOption.getAttribute('data-dosages');

        // Update fields in the form based on selected medicine
        modeField.value = getModeLabel(form);
        qtyField.value = duration;
        dosagesField.value = dosages;
    });

    // Event listener for adding medicine
    addMedicineBtn.addEventListener('click', (event) => {
        event.preventDefault(); // Prevent default form submission behavior

        const selectedMedicine = medicineSelect.value;
        const selectedOption = medicineSelect.options[medicineSelect.selectedIndex];
        const mode = selectedOption.getAttribute('data-form'); // Get mode from selected option
        const days = qtyField.value;
        const dosage = dosagesField.value;
        const instructions = instructionsSelect.value;
        const instructionsText = instructionsSelect.options[instructionsSelect.selectedIndex].text;
        const language = priceField.value;

        // Add row to the medicine table
        const newRow = medicineTableBody.insertRow();
        newRow.innerHTML = `
            <td>${selectedMedicine}</td>
            <td>${getModeLabel(mode)}</td>
            <td>${days}</td>
            <td>${dosage}</td>
            <td data-instruction-id="${instructions}">${instructionsText}</td>
            <td>${language}</td>
            <td><button class="btn btn-danger btn-sm removeBtn">Remove</button></td>
        `;

        // Update hidden input values after adding medicine
        updateHiddenInputValues();

        // Clear the form fields after adding medicine
        resetForm();
    });

    // Event delegation to handle remove button clicks
    medicineTableBody.addEventListener('click', (event) => {
        if (event.target.classList.contains('removeBtn')) {
            const row = event.target.closest('tr');
            medicineTableBody.removeChild(row);

            // Update hidden input values after removal
            updateHiddenInputValues();
        }
    });

    // Function to update hidden input values after adding/removing a row
    function updateHiddenInputValues() {
        const medicineRows = Array.from(medicineTableBody.getElementsByTagName('tr'));
        const medicines = [];
        const modes = [];
        const days = [];
        const dosages = [];
        const instructions = [];
        const prices =[];

        medicineRows.forEach(row => {
            const cells = row.cells;
            medicines.push(cells[0].textContent);
            modes.push(getModeValue(cells[1].textContent));
            days.push(cells[2].textContent);
            dosages.push(cells[3].textContent);
            instructions.push(cells[4].getAttribute('data-instruction-id')); // Get instruction ID from the 5th cell
            prices.push(cells[5].textContent);
            
        });

        // Join arrays into comma-separated strings for hidden input values
        Medicine_input.value = medicines.join(',');
        Mode_input.value = modes.join(',');
        Days_input.value = days.join(',');
        Dosage_input.value = dosages.join(',');
        Instructions_input.value = instructions.join(',');
        Language_input.value = prices.join(','); // Since we're no longer tracking languages
    }

    // Function to get mode label based on mode value
    function getModeLabel(value) {
        switch (value) {
            case '1':
                return 'Tab';
            case '2':
                return 'Syp';
            case '3':
                return 'Pwd';
            case '4':
                return 'Capsule';
            case '5':
                return 'Injection';
            case '6':
                return 'Suspension';
            case '7':
                return 'Drop';
            case '8':
                return 'other';
            default:
                return 'Unknown';
        }
    }

    // Function to get mode value based on mode label
    function getModeValue(label) {
        label = label.trim(); // Trim whitespace from the label
        switch (label) {
            case 'Tab':
                return 1;
            case 'Syp':
                return 2;
            case 'Pwd':
                return 3;
            case 'Capsule':
                return 4;
            case 'Injection':
                return 5;
            case 'Suspension':
                return 6;
            case 'Drop':
                return 7;
            case 'other':
                return 8;
            default:
                return 0;
        }
    }

    // Function to reset the form fields
    function resetForm() {
        medicineSelect.selectedIndex = 0;
        modeField.value = '';
        qtyField.value = '';
        dosagesField.value = '';
        priceField.value = '';
        instructionsSelect.selectedIndex = 0;
    }
});

</script>


<script>
  // Function to calculate BMI
  function calculateBMI() {
      // Get the values of weight and height
      let weight = document.getElementById('inputWeight').value;
      let height = document.getElementById('inputHeight').value;
      
      // Validate weight and height to ensure they have values and are greater than zero
      if (weight && height > 0) {
        // Calculate BMI
        let bmi = (weight / (height * height)).toFixed(2); // Rounded to 2 decimal places

        // Display BMI in the BMI input field
        document.getElementById('inputBMI').value = bmi;
      } else {
        // Clear the BMI input field if values are invalid
        document.getElementById('inputBMI').value = '';
      }
  }
  
  // Event listener for input fields
  document.getElementById('inputWeight').addEventListener('input', calculateBMI);
  document.getElementById('inputHeight').addEventListener('input', calculateBMI);
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<!-- <script>
        // Initialize Select2
        $(document).ready(function() {
            $('#medicineSelect').select2();
        });

        // Initialize Select2
        $(document).ready(function() {
          $('#instructionsSelect').select2();
      });

        // Initialize Select2
        $(document).ready(function() {
          $('#advice').select2();
        });

        // Initialize Select2
        $(document).ready(function() {
          $('#kco').select2();
        });

</script> -->


    
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

<!-- Bootstrap Select JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.18/dist/js/bootstrap-select.min.js"></script>

<script>
    $(document).ready(function() {
        $('.selectpicker').selectpicker();
    });
</script>
 

</body>
</html>
{% endblock %}